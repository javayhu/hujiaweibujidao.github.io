<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>
       Head First Android Testing 2 &middot;  Hujiawei Bujidao
    </title>

    <meta name="generator" content="Hugo 0.29" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta property="og:title" content=" Head First Android Testing 2 &middot;  Hujiawei Bujidao" />
  	<meta property="og:site_name" content="Hujiawei Bujidao" />
  	<meta property="og:url" content="https://hujiaweibujidao.github.io/blog/2015/05/31/head-first-android-testing-2/" />

    
  	<meta property="og:type" content="article" />
    <meta property="og:article:published_time" content="2015-05-31T00:00:00Z" />
    
    <meta property="og:article:tag" content="android" />
    
    

    <meta name="description" content="Happy Coding &amp; Enjoy Living" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://hujiaweibujidao.github.io/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://hujiaweibujidao.github.io/images/apple-touch-icon.png" />
    <link rel="stylesheet" type="text/css" href="https://hujiaweibujidao.github.io/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://hujiaweibujidao.github.io/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="https://hujiaweibujidao.github.io/css/hugo.css" />

    
    <link rel="stylesheet" type="text/css" href="https://hujiaweibujidao.github.io/css/highlight.css">
    
    <link rel="stylesheet" type="text/css" href="https://hujiaweibujidao.github.io/css/github-gist.css">
    
    <script src="https://hujiaweibujidao.github.io/js/highlight.js"></script>
    <script type="text/javascript">hljs.initHighlightingOnLoad();</script>

    
    

    
      
          <link href="https://hujiaweibujidao.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Hujiawei Bujidao" />
      
      
    

    <link rel="canonical" href="https://hujiaweibujidao.github.io/blog/2015/05/31/head-first-android-testing-2/" />

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://hujiaweibujidao.github.io/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://hujiaweibujidao.github.io/android">Android</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://hujiaweibujidao.github.io/python">Python</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://hujiaweibujidao.github.io/swift">Swift</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://hujiaweibujidao.github.io/about">About</a>
            </li>
        

        <li class="nav-opened" role="presentation"><a href=""></a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/algorithm/">tags/algorithm</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/android/">tags/android</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/swift/">tags/swift</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/reactnative/">tags/reactnative</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/python/">tags/python</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/java/">tags/java</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/dev/">tags/dev</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/life/">tags/life</a></li>
    </ul>

    
    

    
        <a class="subscribe-button icon-feed" href="https://hujiaweibujidao.github.io/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




  <header class="main-header post-head" style="background-image: url(https://www.bing.com/ImageResolution.aspx?w=1366&amp;h=768)">
  

    <nav class="main-nav overlay clearfix">
    
        
    
    
        <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
    
</nav>

    <div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title">Head First Android Testing 2</h1>
            <h2 class="page-description">Hujiawei Bujidao</h2> <br/>
            
    <a class="bloglogo" href="https://github.com/hujiaweibujidao" target="_blank">
    <span class="icon-github" style="color:white;font-size:2em"></span>
    </a>
&nbsp;


    <a class="bloglogo" href="https://weibo.com/hujiaweiyinger" target="_blank">
        <span class="icon-twitter" style="color:white;font-size:2em"></span>
    </a>
&nbsp;




    <a class="bloglogo" href="https://www.linkedin.com/in/hujiaweibujidao" target="_blank">
        <span class="icon-linkedin" style="color:white;font-size:2em"></span>
    </a>
&nbsp;


        </div>
    </div>
</header>



<main class="content" role="main">
  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Head First Android Testing 2</h1>
        

        <section class="post-meta">
        
          <span class="post-tag small"><a href="https://hujiaweibujidao.github.io/tags/android/">#android</a></span>
        
        &nbsp;&nbsp;
        
          <time class="post-date" datetime="2015-05-31T00:00:00Z">
            2015/5/31
          </time>
        
        </section>
        <br/>
    </header>

    <section class="post-content">
      <p>æ·±å…¥æµ…å‡ºAndroidæµ‹è¯•æ•™ç¨‹ (2) </p>

<p>###ç¬¬äºŒéƒ¨åˆ† Instrumentation Tests</p>

<p>Instrumentation Testsåˆå«Device or Emulator Testsï¼Œå³è¿è¡Œåœ¨è®¾å¤‡æˆ–è€…æ¨¡æ‹Ÿå™¨ä¸Šçš„æµ‹è¯•ã€‚ä½¿ç”¨<code>AndroidJunitRunner</code>æ¥è¿è¡Œï¼Œæµ‹è¯•ä»£ç å­˜æ”¾åœ¨<code>androidTest</code>ç›®å½•ä¸‹ã€‚</p>

<p>â‘ Run on Device or Emulator
â‘¡Run With <code>AndroidJUnitRunner</code>
â‘¢Located <code>androidTest/</code> source set</p>

<p>ä½¿ç”¨å®ƒéœ€è¦ä¾èµ–Android Support Repositoryï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡SDK Managerä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Support Repositoryã€‚</p>

<p>å‚è€ƒç½‘å€<a href="http://developer.android.com/tools/testing-support-library/index.html">Testing Support Library</a>æåˆ°ï¼Œä»¥å‰ç”¨æ¥åšæµ‹è¯•çš„<code>InstrumentationTestRunner</code> ç±»åªæ”¯æŒJunit 3ï¼Œè€Œæ–°çš„<code>AndroidJunitRunner</code>ç±»æ”¯æŒJunit 4ã€‚</p>

<p>æµ‹è¯•æ­¥éª¤ï¼š</p>

<p>(1)é…ç½®<code>build.gradle</code></p>

<p>å…¶ä¸­<code>testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;</code>ä¸€å®šè¦è®¾ç½®ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°æ‰¾ä¸åˆ°æµ‹è¯•çš„é”™è¯¯ï¼Œå¦å¤–ï¼Œå¦‚æœè¿˜æ˜¯ä½¿ç”¨äº†å…¶ä»–çš„åº“ä¾èµ–çš„è¯ï¼Œä¹Ÿå¯ä»¥ç»§ç»­æ·»åŠ ä¸Šå»ã€‚<code>AndroidJUnitRunner</code>æ˜¯ä¸€ä¸ªåŠŸèƒ½å¾ˆå¼ºå¤§çš„æµ‹è¯•å·¥å…·ç±»ï¼Œæ”¯æŒä»¥ä¸‹å‡ ä¸ªç‰¹æ€§ï¼š</p>

<p>â‘ A new test runner for Android JUnit3/JUnit4 Support
â‘¡Instrumentation Registry
â‘¢Test Filtering
â‘£Intent Monitoring/Stubbing
â‘¤Activity/Application Lifecycle Monitoring</p>

<pre><code class="language-java">apply plugin: 'com.android.application'
android { ...
       defaultConfig {
           ...
           testInstrumentationRunner â€˜android.support.test.runner.AndroidJUnitRunnerâ€™
        }
}
dependencies {
        // AndroidJUnit Runner dependencies
        androidTestCompile 'com.android.support.testğŸƒ0.2'
        androidTestCompile 'org.hamcrest:hamcrest-library:1.1'
}
</code></pre>

<p>(2)é…ç½®<code>Builde Variants</code>ï¼Œé€‰æ‹©<code>Android Instrumentation Tests</code></p>

<p><img src="https://hujiaweibujidao.github.io/images/instrumentationtest_buildvariants.png" alt="image" /></p>

<p>(3)ç¼–å†™Instrumentation Testç¨‹åºï¼Œæ”¾åœ¨<code>src/androidTest/java</code>ç›®å½•ä¸‹</p>

<p>ç±»<code>ObjectUtil</code>è¿˜æ˜¯å’Œå‰é¢çš„Unit Testä¸­ä¸€æ ·ï¼Œåªæ˜¯æ·»åŠ ä¸€ä¸ªæ–°çš„æµ‹è¯•ç±»</p>

<pre><code>import android.content.Context;
import android.support.test.InstrumentationRegistry;
import android.support.test.filters.RequiresDevice;
import android.support.test.runner.AndroidJUnit4;
import android.test.suitebuilder.annotation.SmallTest;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;

import java.io.Serializable;

import polaris.util.ObjectUtil;

import static org.hamcrest.core.Is.is;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.assertThat;

@RunWith(AndroidJUnit4.class)
@SmallTest
public class InstrumentationTestSample {

    Context mMockContext;

    ObjectUtil objectUtil;
    private static final String fileName = &quot;demo&quot;;

    @Before
    public void setUp() throws Exception {
        mMockContext = InstrumentationRegistry.getContext();
        objectUtil = new ObjectUtil(mMockContext);
    }

    @Test
    public void testNotNull() {//ok
        //can not find symbol class R
        //when(mMockContext.getString(R.string.app_name)).thenReturn(&quot;polaris&quot;);
        //assertThat(mMockContext.getString(R.string.app_name), is(&quot;polaris&quot;));

        assertNotNull(mMockContext);
        assertNotNull(objectUtil);
    }

    @Test
    public void testSaveAndLoad() {//fail
        User user = new User(1, &quot;hujiawei&quot;);
        objectUtil.save(user, fileName);

        user = (User) objectUtil.load(fileName);
        assertThat(user.name, is(&quot;hujiawei&quot;));
    }

    static class User implements Serializable {
        int id;
        String name;

        User(int id, String name) {
            this.id = id;
            this.name = name;
        }
    }

    @After
    public void tearDown() throws Exception {
    }

}
</code></pre>

<p>(4)é…ç½®æµ‹è¯•çš„è¿è¡Œå‚æ•°</p>

<p><img src="https://hujiaweibujidao.github.io/images/instrumentation_configuration.png" alt="image" /></p>

<p>(5)è¿è¡Œæµ‹è¯•æœ‰ä¸¤ç§æ–¹å¼ï¼Œå¯ä»¥ç®€å•åœ°å’Œè¿è¡Œæ™®é€šç¨‹åºä¸€æ ·ç‚¹å‡»RunæŒ‰é’®ï¼Œç»“æœä¼šæ˜¾ç¤ºåœ¨ä¸‹é¢çš„Runè§†å›¾çª—å£ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ç»ˆç«¯è¿è¡Œ<code>./gradlew connectedAndroidTest</code>ï¼Œç»“æœå°†æ”¾åœ¨<code>/build/outputs/reports/androidTests/connected/</code>ä¸­ï¼Œæ‰“å¼€<code>index.html</code>æ–‡ä»¶å³å¯ã€‚å‰è€…åªè¿è¡Œå½“å‰æµ‹è¯•çš„è¿è¡Œå‚æ•°ä¸­é…ç½®çš„æµ‹è¯•ç±»å’Œæ–¹æ³•ï¼Œè€Œåè€…ä¼šæ£€æµ‹æ•´ä¸ªé¡¹ç›®ä¸­çš„æ‰€æœ‰Instrumentation Testå¹¶è¿›è¡Œæµ‹è¯•ã€‚</p>

<p><img src="https://hujiaweibujidao.github.io/images/instrumentation_run.png" alt="image" /></p>

<p><img src="https://hujiaweibujidao.github.io/images/instrumentation_html.png" alt="image" /></p>

<p><strong>Instrumentation Registry</strong></p>

<p>é€šè¿‡Instrumentation Registryæˆ‘ä»¬å¯ä»¥è·å–å¾ˆå¤šAndroidè¿è¡ŒçŠ¶æ€ä¸‹çš„ç»„ä»¶ã€‚</p>

<p>You can use the <code>InstrumentationRegistry</code> class to access information related to your test run. This class includes the <code>Instrumentation</code> object, target app <code>Context</code> object, test app <code>Context</code> object, and the command line arguments passed into your test. This data is useful when you are writing tests using the UI Automator framework or when writing tests that have dependencies on the <code>Instrumentation</code> or <code>Context</code> objects.</p>

<pre><code>@Before
public void accessAllTheThings() {
  mArgsBundle = InstrumentationRegistry.getArguments();
  mInstrumentation = InstrumentationRegistry.getInstrumentation();
  mTestAppContext = InstrumentationRegistry.getContext();
  mTargetContext = InstrumentationRegistry.getTargetContext();
}
</code></pre>

<p><strong>ï¿¼Test Filters</strong></p>

<p>é€šè¿‡Test Filtersæˆ‘ä»¬å¯ä»¥æŒ‡å®šæµ‹è¯•æ—¶çš„æœ€å°SDKç‰ˆæœ¬æˆ–è€…æ˜¯å¦å¿…é¡»ä½¿ç”¨è®¾å¤‡ã€‚</p>

<p><code>@RequiresDevice</code>: Specifies that the test should run only on physical devices, not on emulators.</p>

<p><code>@SdkSupress</code>: Suppresses the test from running on a lower Android API level than the given level. For example, to suppress tests on all API levels lower than 18 from running, use the annotation @SDKSupress(minSdkVersion=18).</p>

<p><code>@SmallTest</code>, <code>@MediumTest</code>, and <code>@LargeTest</code>: Classify how long a test should take to run, and consequently, how frequently you can run the test.</p>

<pre><code>@SdkSuppress(minSdkVersion=15)
@Test
public void featureWithMinSdk15() {
...
}

@RequiresDevice
@Test
public void SomeDeviceSpecificFeature() {
...
}
</code></pre>

<p>å¯ä»¥çœ‹å‡ºInstrumentation Testçš„åŠŸèƒ½è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œè¿™é‡Œåªæ˜¯å†°å±±ä¸€è§’ï¼Œæ„Ÿå…´è¶£å¯ä»¥ç»§ç»­é˜…è¯»æ›´å¤šçš„èµ„æ–™å»å­¦ä¹ ï¼ŒEnjoy itï¼</p>
    </section>

    <footer class="post-footer">
      
        <figure class="author-image">
            <a class="img" href="https://hujiaweibujidao.github.io/" style="background-image: url(https://hujiaweibujidao.github.io/images/logo.gif)"><span class="hidden">hujiawei's Picture</span></a>
        </figure>
      

      





<section class="author" style="width:100%;">
  <div class="author-meta" style="width:100%;text-align:center;">
    <span class="author-location icon-user"> Hujiawei is a mobile developer</span>
    <span class="author-location icon-location"> Guangdong, China</span>
    <span class="author-link icon-link"><a href="https://hujiaweibujidao.github.io/"> https://hujiaweibujidao.github.io/</a></span>
    <span class="author-profile" style="width:100%;line-height:1.5em;">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè¯·å‹¿éšæ„è½¬è½½ï¼Œå¦‚éœ€è½¬è½½è¯·è”ç³»æˆ‘ (<a href="mailto:hujiawei090807@gmail.com">hujiawei090807 AT gmail.com</a>)</span>

    <span class="author-profile" style="width:100%;line-height:2em;font-weight:bold;color:#df5000;margin-top:10px;">æˆ‘åœ¨å°ä¸“æ æœ‰ä¸ªç§»åŠ¨å¼€å‘æŠ€æœ¯ä¸“æ ï¼Œä¸å®šæœŸåˆ†äº«ç§»åŠ¨å¼€å‘çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œæ€»ç»“ç§»åŠ¨å¼€å‘çš„å®æˆ˜ç»éªŒ<br/>æ‰€æœ‰æ–‡ç« çš†ä¸ºåŸåˆ›ï¼Œå†…å®¹åˆ¶ä½œç²¾è‰¯ï¼Œä¿è¯å¹²è´§æ»¡æ»¡ï¼Œæ¬¢è¿è®¢é˜… (<a style="color:#df5000;" href="https://xiaozhuanlan.com/u/javayhu">https://xiaozhuanlan.com/u/javayhu</a>) <br/>
    >>> æˆ‘æœ€è¿‘åœ¨Androidé¢è¯•æŒ‡å—å°ä¸“æ é‡Œé¢å†™äº†ä¸€ç¯‡ç¨¿å­ <a style="color:#df5000;" href="https://xiaozhuanlan.com/topic/1932587460"> [Androidé¢è¯•â€”â€”ç®—æ³•é¢è¯•å¿ƒå¾—] </a>ï¼Œæ¬¢è¿é˜…è¯»ï¼&lt;&lt;&lt;  </span>

    <span class="author-profile" style="width:100%;line-height:1.5em;">ä¸‹é¢çš„äºŒç»´ç æ˜¯æˆ‘ä¸ªäººç»´æŠ¤çš„å¾®ä¿¡å…¬ä¼—å·â€œæ½‡æ¶§æŠ€æœ¯ä¸“æ â€ï¼Œä¼šä¸å®šæœŸåˆ†äº«ç§»åŠ¨å¼€å‘çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œæ¬¢è¿å…³æ³¨ï¼<br/>
    	<img src="https://hujiaweibujidao.github.io/images/qrcode_weixin.jpg" />
    </span>
  </div>
</section>


      
        <aside class="read-next">
  
      <span class="readmore-prev readmore-meta">PREV: <a href="https://hujiaweibujidao.github.io/blog/2015/05/30/head-first-android-testing-1/"><h4>Head First Android Testing 1</h4></a></span>
      
  

  
      <span class="readmore-next readmore-meta">NEXT: <a href="https://hujiaweibujidao.github.io/blog/2015/05/31/android-universal-image-loader/"><h4>Android Universal Image Loader</h4></a></span>
      
  
</aside>
<br/>

      
      
      

	
	<div id="lv-container" data-id="city" data-uid="MTAyMC8zMTA1MS83NTk5">
		<script type="text/javascript">
	   (function(d, s) {
	       var j, e = d.getElementsByTagName(s)[0];

	       if (typeof LivereTower === 'function') { return; }

	       j = d.createElement(s);
	       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
	       j.async = true;

	       e.parentNode.insertBefore(j, e);
	   })(document, 'script');
		</script>
	<noscript> ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
	</div>
	

	

		

		
		
		
		
		
		

		
		
	


    </footer>
</article>

</main>

    <footer class="site-footer clearfix">
        <a id="gotop" class="icon-arrow-up" href="#" title="back to top"></a>

        <section class="copyright"><a href="">Hujiawei Bujidao. </a> All rights reserved &copy; 2013 - 2018</section>
        
        <section class="poweredby">Proudly generated by <a href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme &nbsp;
            
            <script type="text/javascript">
                var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
                document.write(unescape("%3Cspan id='cnzz_stat_icon_1000165127'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1000165127%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
            </script>
        </section>
        
    </footer>
  </div> 
    <script type="text/javascript" src="https://hujiaweibujidao.github.io/js/jquery.js"></script>
    <script type="text/javascript" src="https://hujiaweibujidao.github.io/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://hujiaweibujidao.github.io/js/index.js"></script>

    
    
    
    

    
</body>
</html>

